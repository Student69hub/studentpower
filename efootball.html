<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>พรรคนักเรียน | หน้าแรก</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@400;600;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
</head>

<body>
  <div id="particles-js-global" style="position: fixed; width: 100vw; height: 100vh; top: 0; left: 0; z-index: -2; pointer-events: none;"></div>

  <nav class="nav">
    <div class="nav-inner">
      <a href="index.html" class="nav-logo">
        <img src="assets/school-logo.png" alt="โลโก้พรรคนักเรียน" class="nav-logo-img">
        <span class="nav-logo-text">พรรคนักเรียน</span>
      </a>
      <button type="button" class="nav-toggle" id="nav-toggle" aria-label="เปิดเมนู">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <ul class="nav-links" id="nav-links">
        <li><a href="index.html">หน้าแรก</a></li>
        <li><a href="policy.html">นโยบาย</a></li>
        <li><a href="about.html">เกี่ยวกับเรา</a></li>
        <li><a href="contact.html">ติดต่อ</a></li>
        <li><a href="members.html">สมาชิก</a></li>
        <li class="nav-item-dropdown">
          <a href="#" class="nav-dropdown-toggle">ประกาศข่าวสาร ▾</a>
          <ul class="nav-dropdown-menu">
            <li><a href="news-efootball.html">ข่าวสาร Efootball</a></li>
            <li><a href="news-classroom.html">ประกวดห้องเรียน</a></li>
            <li><a href="news-general.html">ข่าวสารทั่วไป</a></li>
          </ul>
        </li>
        <li class="nav-item-dropdown">
          <a href="efootball.html" class="nav-dropdown-toggle active">การแข่งขัน Efootball ▾</a>
          <ul class="nav-dropdown-menu">
            <li><a href="efootball-register.html">สมัครนักแข่ง</a></li>
            <li><a href="efootball.html" class="active">ตารางคะแนน</a></li>
            <li><a href="efootball-players.html">รายชื่อนักแข่ง</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </nav>

  <main id="main-content" class="page-enter">

    <!-- ===== eFootball League Table Section ===== -->
    <section class="content-section table-section" data-aos="fade-up">
      <div class="container">
        <h2 class="section-title" style="text-align: center; margin-bottom: 2rem;">ตารางคะแนน eFootball Student League
        </h2>

        <div class="league-table-container">
          <table class="league-table">
            <thead>
              <tr>
                <th class="col-pos">อันดับ</th>
                <th class="col-club">ผู้เข้าแข่งขัน (ทีม)</th>
                <th class="col-stat" title="แข่ง (Played)">แข่ง</th>
                <th class="col-stat" title="ชนะ (Won)">ชนะ</th>
                <th class="col-stat" title="เสมอ (Drawn)">เสมอ</th>
                <th class="col-stat" title="แพ้ (Lost)">แพ้</th>
                <th class="col-stat" title="ได้ (Goals For)">ได้</th>
                <th class="col-stat" title="เสีย (Goals Against)">เสีย</th>
                <th class="col-gd" title="ประตูได้เสีย (Goal Difference)">ผลต่าง</th>
                <th class="col-pts" title="คะแนน (Points)">แต้ม</th>
              </tr>
            </thead>
            <tbody id="league-body"> <!-- JS will inject dynamic sorted rows here --> </tbody>
          </table>

        </div>

        <div style="text-align: center; margin-top: 1.5rem;">
          <a href="#" class="btn btn-outline"
            style="color: var(--color-dark); border-color: rgba(0,0,0,0.2);">ดูรายละเอียดการแข่งทั้งหมด</a>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="footer-inner">
        <div class="footer-grid">
          <div class="footer-brand">พรรคนักเรียน</div>
          <div class="footer-social">
            <a href="https://www.instagram.com/n.xrongritt_/" target="_blank" rel="noopener noreferrer"
              class="instagram" title="Instagram">@n.xrongritt_</a>
            <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Facebook">FB</a>
            <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Twitter">X</a>
            <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Line">LINE</a>
          </div>
        </div>
        <div class="footer-bottom">
          © พรรคนักเรียน — สร้างสรรค์เพื่อนักเรียน โดยนักเรียน
        </div>
      </div>
    </footer>
  </main>

  <script type="module" src="firebase-config.js"></script>
  <script src="script.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const TEAMS = [
        "Arsenal", "Aston Villa", "Bournemouth", "Brentford", "Brighton & Hove Albion",
        "Burnley", "Chelsea", "Crystal Palace", "Everton", "Fulham",
        "Leeds United", "Liverpool", "Manchester City", "Manchester United", "Newcastle United",
        "Nottingham Forest", "Sunderland", "Tottenham Hotspur", "West Ham United", "Wolverhampton Wanderers"
      ];

      const tbody = document.getElementById('league-body');

      if (tbody) {
        tbody.innerHTML = '<tr><td colspan="10" style="text-align:center; padding: 2rem;">กำลังโหลดตารางคะแนน... ⚽</td></tr>';

        setTimeout(() => {
          if (!window.firebaseDB) {
            console.error("Firebase not loaded yet");
            tbody.innerHTML = '<tr><td colspan="10" style="text-align:center; padding: 2rem; color: #ef4444;">เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล</td></tr>';
            return;
          }

          const scoresRef = window.firebaseRef(window.firebaseDB, 'scores');

          window.firebaseOnValue(scoresRef, (snapshot) => {
            let parsed = {};
            if (snapshot.exists()) {
              parsed = snapshot.val();
            }

            let tableData = [];

            TEAMS.forEach(team => {
              const stats = parsed[team] || { played: 0, won: 0, drawn: 0, lost: 0, gf: 0, ga: 0 };
              const gd = stats.gf - stats.ga;
              const pts = (stats.won * 3) + (stats.drawn * 1);
              tableData.push({ team, ...stats, gd, pts });
            });

            // Sort: Points(desc) -> GD(desc) -> GF(desc) -> Name(asc)
            tableData.sort((a, b) => {
              if (b.pts !== a.pts) return b.pts - a.pts;
              if (b.gd !== a.gd) return b.gd - a.gd;
              if (b.gf !== a.gf) return b.gf - a.gf;
              return a.team.localeCompare(b.team);
            });

            tbody.innerHTML = '';
            tableData.forEach((row, index) => {
              const pos = index + 1;
              let rowClass = "";
              let badgeClass = "pos-badge";

              if (pos === 1) {
                rowClass = ' class="row-champion"';
                badgeClass = "pos-badge pos-1";
              } else if (pos === 2) {
                rowClass = ' class="row-runnerup"';
                badgeClass = "pos-badge pos-2";
              }

              // Use conditional formatting for GD (e.g. +12)
              const formattedGd = row.gd > 0 ? '+' + row.gd : row.gd;

              // Generate Safe Team ID for Image Matching
              let saveTeamId = row.team.replace(/[^a-zA-Z0-9]/g, '');

              // Dynamic color for GD
              let gdColor = "inherit";
              if (row.gd > 0) gdColor = "#10b981"; // Green
              else if (row.gd < 0) gdColor = "#ef4444"; // Red

              // Special case for Liverpool as requested by user
              let logoSrc = `assets/clubs/${saveTeamId}.svg`;
              let logoOnerror = `if(this.src.endsWith('.svg')){this.src='assets/clubs/${saveTeamId}.png'}else{this.src='assets/school-logo.png'}`;

              if (row.team === "Liverpool") {
                logoSrc = `assets/clubs/Liverpool.png`;
                logoOnerror = `this.src='assets/school-logo.png'`;
              } else if (row.team === "Aston Villa") {
                logoSrc = 'https://resources.premierleague.com/premierleague/badges/t7.svg';
              }

              // Apply specific scaling for Liverpool as it visually looks smaller
              const logoStyle = row.team === "Liverpool"
                ? "width:36px;height:36px;border-radius:4px;object-fit:contain;transform:scale(2.5);"
                : "width:36px;height:36px;border-radius:4px;object-fit:contain;";

              tbody.innerHTML += `
                          <tr${rowClass}>
                              <td class="col-pos"><span class="${badgeClass}">${pos}</span></td>
                              <td class="col-club">
                                  <div class="club-info">
                                      <img src="${logoSrc}" alt="${row.team} logo" class="club-logo" style="${logoStyle}" onerror="${logoOnerror}">
                                      <span class="club-name">${row.team}</span>
                                  </div>
                              </td>
                              <td class="col-stat">${row.played}</td>
                              <td class="col-stat">${row.won}</td>
                              <td class="col-stat">${row.drawn}</td>
                              <td class="col-stat">${row.lost}</td>
                              <td class="col-stat">${row.gf}</td>
                              <td class="col-stat">${row.ga}</td>
                              <td class="col-gd" style="color: ${gdColor}">${formattedGd}</td>
                              <td class="col-pts">${row.pts}</td>
                          </tr>
                      `;
            });
          });
        }, 500);
      }
    });
  </script>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script src="interactions.js"></script>
</body>

</html>